import{d as J,m as C,n as L,o as W,p as Z,q as ee,t as se,r as i,M as te,U as ae,j as a,Q as re,v as ne,I as oe,C as E,w as le,b as j,B as N,x as ce,y as ie,z as ue,A as de}from"./index-8b4e7341.js";function me(r){const c=["Bytes","KB","MB","GB","TB"];if(r===0)return"0 Byte";const o=parseInt(Math.floor(Math.log(r)/Math.log(1024)),10);return`${(r/Math.pow(1024,o)).toFixed(2)} ${c[o]}`}async function pe(r,c){try{const o=J.currentUser;if(!o)throw new Error("User is not logged in.");const u=o.uid,l=C(L,`users/${u}/mp3s`,r);await W(l,c),console.log(`MP3 with ID ${r} updated successfully!`)}catch(o){console.error("Failed to update MP3:",o.message)}}const fe=async(r,c,o,u,l,d,h)=>{try{const m=await fetch(r,{method:"GET",headers:{Range:`bytes=0-${l-1}`}});return m.status===206||m.status===200?(u.info("Link is fresh and valid"),!0):(u.info("Executing link refresh."),await he(u,c,o,d,h),!1)}catch(m){return console.error("Error checking the link:",m.message),u.error("Error checking the link."),null}},he=async(r,c,o,u,l)=>{const d=await Z(u,l);try{const m=await ee({method:"get",url:"https://youtube-mp36.p.rapidapi.com/dl",headers:{"X-RapidAPI-Key":"bb6ca9e02bmsh37ace359628eb67p1cfcfcjsn8051f8356a0f","X-RapidAPI-Host":"youtube-mp36.p.rapidapi.com"},params:{id:c}}),{link:w}=m==null?void 0:m.data;if(!w){r.error("No download link provided. Please try again later.");return}const v=d.map(f=>f.youtubeID===c?{...f,url:w}:f),y=v.find(f=>f.youtubeID===c);if(y)return await pe(c,y),o(v),r.success("Link refreshed and replaced successfully!"),!0}catch(h){return r.error("Failed to refresh the link. Please try again."),console.error("Error refreshing the link:",h),!1}};async function ge(r,c,o,u){try{if(!r||!r.uid)throw new Error("User is not logged in.");const l=r.uid,d=C(L,`users/${l}/mp3s`,c);return await se(d),o.success(u+" deleted succesfully!"),!0}catch(l){return console.error("Failed to delete MP3:",l==null?void 0:l.message),o.error("Failed to delete MP3:",l==null?void 0:l.message),!1}}const ye=()=>{const{mp3List:r,setMP3List:c,loading:o}=i.useContext(te),{authUser:u,loadingUser:l}=i.useContext(ae),[d,h]=i.useState(null),[m,w]=i.useState({}),[v,y]=i.useState(null),[f,k]=i.useState({volumes:{},progresses:{},tooltips:{}}),[S,R]=i.useState({}),[F,D]=i.useState(""),[I,T]=i.useState({}),g=i.useRef([]),x=g.current,$=e=>{const s=x[e];T(t=>({...Object.keys(t).reduce((n,p)=>(n[p]=!1,n),{}),[e]:!t[e]})),s.paused?s.play():s.pause(),h(e)},z=(e,s)=>{const t=g.current[s];if(t){const n=e.target.value/100*t.duration;t.currentTime=n,k(p=>({...p,progresses:{...p.progresses,[s]:e.target.value}}))}};i.useCallback(()=>{const e=(d+1)%r.length;h(e)},[d,r]),i.useCallback(()=>{const e=(d-1+r.length)%r.length;h(e)},[d,r]);const B=i.useCallback((e,s)=>{const t=e.target.value;k(n=>({...n,volumes:{...n.volumes,[s]:t}})),x[s].volume=t},[]),U=e=>{const s=g.current[e];s&&k(t=>({...t,progresses:{...t.progresses,[e]:s.currentTime/s.duration*100}}))};i.useEffect(()=>{r.forEach((e,s)=>{const t=g.current[s];if(t){const n=()=>U(s);return t.addEventListener("timeupdate",n),()=>t.removeEventListener("timeupdate",n)}})},[r]),i.useEffect(()=>{(async()=>{if(d!==null){try{await x[d].play()}catch{j.error("Playback failed. Try refreshing the link.")}x.forEach((s,t)=>{s&&t!==d&&s.pause()})}})()},[d]);const A=e=>{const s=x[e];s&&isFinite(s.duration)&&R(t=>({...t,[e]:s.duration}))},_=e=>{var p;const s=(p=r[e])==null?void 0:p.title,t=!m[e];w(P=>({...P,[e]:t}));const n=g.current[e];n&&(n.loop=t),j.dark(t?`Looping enabled for: ${s}`:`Looping disabled for: ${s}`)},V=e=>{if(!isFinite(e))return"00:00";const s=Math.floor(e/60),t=Math.floor(e%60);return`${String(s).padStart(2,"0")}:${String(t).padStart(2,"0")}`},O=async e=>{y(e.url);try{await fe(e.url,e.youtubeID,c,j,e.fileSize,u,l)}catch(s){console.error("Error refreshing the link:",s)}finally{y(null)}},G=async e=>{u?(await ge(u,e.youtubeID,j,e.title),c(s=>s.filter(t=>t.youtubeID!==e.youtubeID))):j.error("You need to be logged in to delete this song.")},K=a.jsx("div",{className:"flex min-h-screen",children:a.jsx("section",{className:"flex-grow",children:a.jsx(E,{})})}),X=a.jsx("p",{className:"text-lg text-center text-gray-300 h-screen",children:"Convert any music to be able to listen to it here."}),q=({isPlaying:e,onClick:s})=>a.jsx(N,{aria_label:"Play&Pause",children:e?a.jsx(ce,{className:"stroke-green-400",size:20}):a.jsx(ie,{className:"stroke-gray-400 ",size:20}),onClick:s,className:"p-2 rounded-full bg-transparent hover:bg-[#777]"}),H=({onRefresh:e,onDelete:s})=>a.jsxs("div",{className:"flex space-x-1 sm:space-x-4",children:[a.jsx(N,{aria_label:"Refresh item",children:"Refresh Link",onClick:e,className:"py-1 px-1 text-sm sm:py-2 sm:px-4 sm:text-base bg-[#555] text-[#4ecb52] hover:bg-[#777]"}),a.jsx(N,{aria_label:"Delete item",children:"Delete item",onClick:s,className:"py-1 px-1 text-sm sm:py-2 sm:px-4 sm:text-base bg-[#555] text-[#FF5252] hover:bg-[#777]"})]}),Q=({progress:e,onChange:s,tooltip:t})=>a.jsxs("div",{className:"relative w-full h-2 bg-gray-600 rounded-full max-w-[1000px]",children:[a.jsx("div",{className:"absolute top-0 left-0 h-full bg-green-500 rounded-full",style:{width:`${e}%`}}),a.jsx("input",{type:"range",min:"0",max:"100",className:"absolute top-0 left-0 w-full h-2 appearance-none cursor-pointer bg-transparent z-10",style:{opacity:0},value:e,onChange:s}),(t==null?void 0:t.visible)&&a.jsx("div",{style:{position:"absolute",left:t.x,top:t.y},children:t.time})]}),Y=({isLooping:e,onLoopToggle:s,volume:t,onVolumeChange:n,fileSize:p})=>a.jsxs("div",{className:"flex items-center space-x-4 w-full",children:[a.jsx(N,{aria_label:"Repeat",children:a.jsx(ue,{className:e?"stroke-green-400":"stroke-gray-400",size:20}),onClick:s,className:"p-3 rounded-full bg-transparent hover:bg-[#777]"}),a.jsxs("div",{className:"flex items-center m-0 w-full space-x-3 max-w-[400px]",children:[a.jsx(de,{className:"stroke-green-400",size:35}),a.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:t,onChange:n,className:"h-2 w-full rounded-lg cursor-pointer accent-green-500"}),a.jsxs("p",{className:"text-gray-400 text-sm text-right whitespace-nowrap",children:["File size: ",p]})]})]});return a.jsxs("div",{className:"bg-[#1E1E1E] pt-20 px-2 sm:px-6 py-14 sm:py-8",children:[a.jsx(re,{stacked:!0,position:"bottom-right",transition:ne,limit:8}),a.jsxs("div",{className:"bg-[#1E1E1E] p-4 flex justify-center items-center space-x-8",children:[a.jsx("h1",{className:"text-2xl font-bold text-white ",children:"Music Player"}),a.jsx(oe,{type:"search",placeholder:"Search for a song",value:F,onChange:e=>D(e.target.value),className:"my-4 text-white bg-[#333] border-[#444] rounded w-full max-w-[600px] p-2"})]}),o?K:Object.keys(r).length===0?X:a.jsx("ul",{className:"space-y-4 sm:space-y-6 text-ssm max-w-[1000px] w-full min-h-screen mx-auto",children:r.map((e,s)=>{var M;const t=I[s]&&!((M=x[s])!=null&&M.paused),n=m[s]||!1,p=V(S[s]||0),P=v===e.url;return a.jsx("li",{className:` ${P?"cursor-wait":"cursor-default"} p-3 sm:p-6 border rounded-lg ${t?"bg-[#494949] border-[#4ada31]":"bg-[#333] border-[#444]"} shadow-md transition-colors duration-300 max-w-full`,children:P?a.jsx(E,{}):a.jsxs("div",{className:"flex flex-col items-center space-y-2 sm:space-y-4 w-full max-w-[1000px] mx-auto",children:[a.jsxs("div",{className:"flex flex-col justify-start items-start text-start w-full space-y-3",children:[a.jsxs("div",{className:"flex items-center w-full",children:[a.jsx(q,{isPlaying:t,onClick:()=>$(s)}),a.jsx(le,{className:"text-sm sm:text-xl",target:"_blank",url:e.youtubeURL,href:e.url,title:e.title})]}),a.jsx("div",{className:"flex justify-between w-full space-x-4",children:a.jsx(H,{onRefresh:()=>O(e),onDelete:()=>G(e)})}),a.jsxs("p",{className:"text-sm text-gray-400 whitespace-nowrap",children:["Duration: ",p]})]}),a.jsx(Q,{progress:f.progresses[s]||0,onChange:b=>z(b,s),tooltip:f.tooltips[s]}),a.jsx(Y,{isLooping:n,onLoopToggle:()=>_(s),volume:f.volumes[s]||.5,onVolumeChange:b=>B(b,s),fileSize:me(e.fileSize)}),a.jsx("audio",{ref:b=>g.current[s]=b,src:e.url,preload:"metadata",onLoadedMetadata:()=>A(s)})]})},s)})})]})};export{ye as default};

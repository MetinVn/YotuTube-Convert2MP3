import{d as te,m as D,n as G,o as se,p as ae,q as re,t as le,G as j,j as s,r as u,M as ne,U as oe,Q as ce,F as ie,I as ue,C as B,B as N,v as de,b as I}from"./index-e8e8a4b5.js";import{a as pe,b as he,c as ge,d as me}from"./index-34ca437a.js";function fe(l){const i=["Bytes","KB","MB","GB","TB"];if(l===0)return"0 Byte";const a=parseInt(Math.floor(Math.log(l)/Math.log(1024)),10);return`${(l/Math.pow(1024,a)).toFixed(2)} ${i[a]}`}async function xe(l,i){try{const a=te.currentUser;if(!a)throw new Error("User is not logged in.");const o=a.uid,h=D(G,`users/${o}/mp3s`,l);await se(h,i),console.log(`MP3 with ID ${l} updated successfully!`)}catch(a){console.error("Failed to update MP3:",a.message)}}const ye=async(l,i,a,o,h,b,m)=>{try{let d;h<=10485760?(d=h-1,console.log("File size is 10MB or less. Fetching the entire file for validation.")):(d=Math.floor(h*.5)-1,console.log("File size is larger than 10MB. Fetching 50% of the file for validation."));const v=await fetch(l,{method:"GET",headers:{Range:`bytes=0-${d}`}});return v.status===206||v.status===200?(o.info("Link is fresh and valid"),!0):(o.info("Executing link refresh."),await be(o,i,a,b,m),!1)}catch(d){return console.error("Error checking the link:",d.message),o.error("Error checking the link."),null}},be=async(l,i,a,o,h)=>{const b=await ae(o,h);try{const d=await re({method:"get",url:"https://youtube-mp36.p.rapidapi.com/dl",headers:{"X-RapidAPI-Key":"bb6ca9e02bmsh37ace359628eb67p1cfcfcjsn8051f8356a0f","X-RapidAPI-Host":"youtube-mp36.p.rapidapi.com"},params:{id:i}}),{link:x}=d==null?void 0:d.data;if(!x){l.error("No download link provided. Please try again later.");return}const v=b.map(n=>n.youtubeID===i?{...n,url:x}:n),w=v.find(n=>n.youtubeID===i);w&&await xe(i,w).then(()=>{a(v),l.success("Link refreshed and replaced successfully!")})}catch(m){l.error("Failed to refresh the link. Please try again."),console.error("Error refreshing the link:",m)}};async function ve(l,i,a){try{if(!l||!l.uid)throw new Error("User is not logged in.");const o=l.uid,h=D(G,`users/${o}/mp3s`,i.youtubeID);return await le(h),a.success(`MP3 named ${i.title} deleted successfully!`),!0}catch(o){return console.error("Failed to delete MP3:",o.message),a.error("Failed to delete MP3:",o.message),!1}}function Ee(l){return j({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M144 479H48c-26.5 0-48-21.5-48-48V79c0-26.5 21.5-48 48-48h96c26.5 0 48 21.5 48 48v352c0 26.5-21.5 48-48 48zm304-48V79c0-26.5-21.5-48-48-48h-96c-26.5 0-48 21.5-48 48v352c0 26.5 21.5 48 48 48h96c26.5 0 48-21.5 48-48z"},child:[]}]})(l)}function we(l){return j({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M424.4 214.7L72.4 6.6C43.8-10.3 0 6.1 0 47.9V464c0 37.5 40.7 60.1 72.4 41.3l352-208c31.4-18.5 31.5-64.1 0-82.6z"},child:[]}]})(l)}function Te(l){return j({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M64 468V44c0-6.6 5.4-12 12-12h48c6.6 0 12 5.4 12 12v176.4l195.5-181C352.1 22.3 384 36.6 384 64v384c0 27.4-31.9 41.7-52.5 24.6L136 292.7V468c0 6.6-5.4 12-12 12H76c-6.6 0-12-5.4-12-12z"},child:[]}]})(l)}function Pe(l){return j({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M384 44v424c0 6.6-5.4 12-12 12h-48c-6.6 0-12-5.4-12-12V291.6l-195.5 181C95.9 489.7 64 475.4 64 448V64c0-27.4 31.9-41.7 52.5-24.6L312 219.3V44c0-6.6 5.4-12 12-12h48c6.6 0 12 5.4 12 12z"},child:[]}]})(l)}function Ne(l){return j({tag:"svg",attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"},child:[]}]})(l)}const je=({title:l,isPlaying:i,onPlay:a,onPause:o,onNext:h,onPrevious:b,onClosePlayer:m,onVolumeChange:d,currentVolume:x})=>s.jsxs("div",{className:`
    fixed z-50 top-1/2 right-2 border border-[#4CAF50] transform -translate-y-1/2 bg-[#333] text-white p-2 rounded-lg shadow-lg 
    w-40 flex flex-col items-center 
    sm:w-48 sm:p-3
    md:w-60 md:p-4
  `,children:[s.jsx("button",{className:"absolute top-1 right-1 text-[#1E1E1E] hover:text-[#4CAF50] sm:top-2 sm:right-2 duration-300",onClick:m,"aria-label":"Close Player",children:s.jsx(Ne,{})}),s.jsx("p",{className:"mb-1 text-center text-xs sm:text-sm md:text-base",children:l}),s.jsxs("div",{className:"flex items-center justify-around w-full",children:[s.jsx("button",{onClick:b,className:`
            text-lg text-[#4CAF50] hover:text-[#388E3C] transition-colors duration-300 
            sm:text-xl md:text-2xl
          `,"aria-label":"Previous Track",children:s.jsx(Te,{})}),s.jsx("button",{onClick:i?a:o,className:`
            text-lg text-[#4CAF50] hover:text-[#388E3C] transition-colors duration-300 
            sm:text-xl md:text-2xl
          `,"aria-label":i?"Play":"Pause",children:i?s.jsx(we,{}):s.jsx(Ee,{})}),s.jsx("button",{onClick:h,className:`
            text-lg text-[#4CAF50] hover:text-[#388E3C] transition-colors duration-300 
            sm:text-xl md:text-2xl
          `,"aria-label":"Next Track",children:s.jsx(Pe,{})})]}),s.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:x||1,onChange:d,className:`
          mt-2 w-full accent-[#4CAF50] 
          sm:mt-3
        `,"aria-label":"Volume Control"})]}),Le=()=>{var R,A;const l={floatingPlayer:!1,playingIndex:null,loopingStates:{},volumes:{},progresses:{},tooltips:{},refreshingItem:null},i=(t,e)=>{switch(e.type){case"SET_FLOATING_PLAYER":return{...t,floatingPlayer:e.payload};case"SET_PLAYING_INDEX":return{...t,playingIndex:e.payload};case"SET_LOOPING_STATES":return{...t,loopingStates:e.payload};case"SET_VOLUME_STATES":return{...t,volumes:e.payload};case"SET_PROGRESS_STATES":return{...t,progresses:e.payload};case"SET_TOOLTIP_STATES":return{...t,tooltips:e.payload};case"SET_REFRESHING_ITEM":return{...t,refreshingItem:e.payload};default:return t}},[a,o]=u.useReducer(i,l),[h,b]=u.useState({}),[m,d]=u.useState({}),[x,v]=u.useState(""),w=u.useRef([]),n=w.current,z=(R=n[a.playingIndex])==null?void 0:R.paused,{mp3List:y,setMP3List:C,loading:O}=u.useContext(ne),{authUser:L,loadingUser:V}=u.useContext(oe),f=Object.keys(y).filter(t=>y[t].title.toLowerCase().includes(x.toLowerCase())),F=u.useCallback(t=>{o({type:"SET_FLOATING_PLAYER",payload:!a.floatingPlayer}),o({type:"SET_PLAYING_INDEX",payload:t})}),k=u.useCallback(t=>{const e=n[t];e.paused?e.play():e.pause(),o({type:"SET_PLAYING_INDEX",payload:t})},[a.playingIndex,n]),$=u.useCallback(()=>{if(f.length>0){const t=(a.playingIndex+1)%f.length;o({type:"SET_PLAYING_INDEX",payload:t})}},[a.playingIndex,f]),X=u.useCallback(()=>{if(f.length>0){const t=(a.playingIndex-1+f.length)%f.length;o({type:"SET_PLAYING_INDEX",payload:t})}},[a.playingIndex,f]),_=u.useCallback((t,e)=>{const r=t.target.value;o({type:"SET_VOLUME_STATES",payload:{...a.volumes,[e]:r}}),n[e]&&(n[e].volume=r)},[n,a.volumes]),U=u.useCallback((t,e)=>{var c;const r=t.target.value/100*(((c=n[e])==null?void 0:c.duration)||0);isFinite(r)&&n[e]&&(n[e].currentTime=r,o({type:"SET_PROGRESS_STATES",payload:{...a.progresses,[e]:t.target.value}}))},[o,n,a.progresses]),Y=t=>{var c;const e=(c=y[t])==null?void 0:c.title,r=!a.loopingStates[t];o({type:"SET_LOOPING_STATES",payload:{...a.loopingStates,[t]:r}}),I.dark(r?"Looping enabled for: "+e:"Looping disabled for: "+e)},M=t=>{if(!isFinite(t))return"00:00";const e=Math.floor(t/60),r=Math.floor(t%60);return`${String(e).padStart(2,"0")}:${String(r).padStart(2,"0")}`},H=u.useCallback((t,e)=>{var E;const r=t.currentTarget,c=r.getBoundingClientRect(),S=(t.clientX-c.left)/c.width*100,P=((E=n[e])==null?void 0:E.duration)||0,T=S/100*P;d(p=>({...p,[e]:{visible:!0,x:t.clientX-c.left+r.offsetLeft,y:t.clientY-c.top-40,time:M(T)}}))}),K=t=>{d(e=>({...e,[t]:{...e[t],visible:!1}}))},q=(t,e)=>{var p;const r=t.touches[0],c=t.currentTarget,g=c.getBoundingClientRect(),P=(r.clientX-g.left)/g.width*100,T=((p=n[e])==null?void 0:p.duration)||0,E=P/100*T;d(ee=>({...ee,[e]:{visible:!0,x:r.clientX-g.left+c.offsetLeft,y:r.clientY-g.top-40,time:M(E)}}))},Q=t=>{d(e=>({...e,[t]:{...e[t],visible:!1}}))},J=()=>{n.forEach((t,e)=>{if(t){const r=()=>{b(c=>({...c,[e]:t.duration}))};return t.addEventListener("loadedmetadata",r),()=>{t.removeEventListener("loadedmetadata",r)}}})};u.useEffect(()=>(J(),()=>{n.forEach(t=>{t&&t.removeEventListener("loadedmetadata",()=>{})})}),[w.current,y.length]),u.useEffect(()=>{const t=e=>{if(n[e]&&isFinite(n[e].duration)){const r=n[e].currentTime/n[e].duration*100;o({type:"SET_PROGRESS_STATES",payload:{...a.progresses,[e]:isFinite(r)?r:0}})}};n.forEach((e,r)=>{if(e){const c=()=>t(r);e.addEventListener("timeupdate",c);const g=()=>{a.loopingStates[r]&&(e.currentTime=0,e.play())};return e.addEventListener("ended",g),()=>{e.removeEventListener("timeupdate",c),e.removeEventListener("ended",g)}}})},[n,a.playingIndex,a.loopingStates]),u.useEffect(()=>{(async()=>{if(a.playingIndex!==null&&n[a.playingIndex])try{await n[a.playingIndex].play()}catch{I.error("Playback failed. Try refreshing the link.")}n.forEach((e,r)=>{e&&r!==a.playingIndex&&e.pause()})})()},[a.playingIndex]);const W=async t=>{o({type:"SET_REFRESHING_ITEM",payload:t.url});try{await ye(t.url,t.youtubeID,C,I,t.fileSize,L,V)}catch(e){console.error("Error refreshing the link:",e)}finally{o({type:"SET_REFRESHING_ITEM",payload:null})}},Z=async(t,e)=>{L&&(await ve(L,t,e),C(r=>r.filter(g=>g.youtubeID!==t.youtubeID)))};return s.jsxs("div",{className:"bg-[#1E1E1E] pt-20 px-2 sm:px-6 py-14 sm:py-8",children:[s.jsx(ce,{stacked:!0,position:"bottom-right",transition:ie,limit:8}),s.jsxs("div",{className:"bg-[#1E1E1E] p-4 flex justify-center items-center",children:[s.jsx("h1",{className:"text-2xl font-bold text-white ",children:"Music Player"}),s.jsx(ue,{type:"search",placeholder:"Search for a song",value:x,onChange:t=>v(t.target.value),className:"my-4 text-white bg-[#333] border-[#444] rounded w-full max-w-[600px] p-2"})]}),O?s.jsx("div",{className:"flex min-h-screen",children:s.jsx("section",{className:"flex-grow",children:s.jsx(B,{})})}):Object.keys(y).length===0?s.jsx("p",{className:"text-lg text-center text-gray-300 h-screen",children:"Convert any music to be able to listen to it here."}):Object.keys(f).length==0?s.jsx("p",{className:"text-lg text-center text-gray-300 h-screen",children:"No music matches your search. Try being more case-sensitive."}):s.jsx("ul",{className:"space-y-4 sm:space-y-6 text-ssm max-w-[1000px] w-full min-h-screen mx-auto",children:f.map((t,e)=>{var E;const r=y[t],c=n[e],g=c==null?void 0:c.paused,S=a.loopingStates[e]||!1,P=M(h[e]||0),T=a.refreshingItem===r.url;return s.jsx("li",{className:` ${T?"cursor-wait":"cursor-default"} p-3 sm:p-6 border rounded-lg ${g?"bg-[#333] border-[#444]":"bg-[#494949] border-[#4ada31]"} shadow-md transition-colors duration-300 max-w-full`,children:T?s.jsx(B,{}):s.jsxs("div",{className:"flex flex-col items-center space-y-2 sm:space-y-4 w-full max-w-[1000px] mx-auto",children:[s.jsxs("div",{className:"flex flex-col justify-start items-start text-start w-full space-y-3",children:[s.jsxs("div",{className:"flex items-center w-full",children:[s.jsx(N,{aria_label:"Play&Pause",children:g?s.jsx(pe,{className:"stroke-gray-400",size:20}):s.jsx(he,{className:"stroke-green-400",size:20}),onClick:()=>k(e),className:"p-2 rounded-full bg-transparent hover:bg-[#777]"}),s.jsx(de,{className:"text-sm sm:text-xl",target:"_blank",url:r.youtubeURL,href:r.url,title:r.title})]}),s.jsx("div",{className:"flex justify-between w-full space-x-4",children:s.jsxs("div",{className:"flex space-x-1 sm:space-x-4",children:[s.jsx(N,{aria_label:"Refresh item",type:"button",children:"Refresh Link",onClick:()=>W(r),className:"py-1 px-1 text-sm sm:py-2 sm:px-4 sm:text-base  bg-[#555] text-[#4ecb52] hover:bg-[#777] duration-300"}),s.jsx(N,{aria_label:"Delete item",type:"button",children:"Delete item",onClick:()=>Z(r,I),className:"py-1 px-1 text-sm sm:py-2 sm:px-4 sm:text-base bg-[#555] text-[#FF5252] hover:bg-[#777]"}),s.jsx(N,{aria_label:"Toggle Floating Player",onClick:()=>F(e),className:"py-1 px-1 text-sm sm:py-2 sm:px-4 sm:text-base bg-green-500 text-white rounded hover:bg-green-700",children:"Toggle Floating Player"})]})}),s.jsxs("p",{className:"text-sm text-gray-400 whitespace-nowrap",children:["Duration: ",P]})]}),s.jsx("div",{className:"flex flex-col items-center space-y-4 w-full",children:s.jsxs("div",{className:"relative w-full h-2 bg-gray-600 rounded-full max-w-[1000px]",children:[s.jsxs("div",{className:"h-2 bg-gray-600 rounded-full",children:[s.jsx("div",{className:"absolute top-0 left-0 h-full bg-green-500 rounded-full",style:{width:`${a.progresses[e]||0}%`}}),s.jsx("div",{className:"absolute top-[-6px] transform -translate-x-1/2 w-5 h-5 bg-white rounded-full shadow-md",style:{left:`${a.progresses[e]||0}%`}}),s.jsx("input",{type:"range",min:"0",max:"100",value:a.progresses[e]||0,onChange:p=>U(p,e),className:"absolute top-0 left-0 w-full h-2 appearance-none cursor-pointer bg-transparent z-10",style:{opacity:0},onMouseMove:p=>H(p,e),onMouseLeave:()=>K(e),onTouchMove:p=>q(p,e),onTouchEnd:()=>Q(e)})]}),((E=m[e])==null?void 0:E.visible)&&s.jsx("div",{style:{left:`${m[e].x}px`,top:`${m[e].y}px`},className:"absolute transform -translate-x-1/2 px-2 py-1 bg-black text-white text-xs rounded",children:m[e].time})]})}),s.jsxs("div",{className:"flex items-center space-x-4 w-full",children:[s.jsx(N,{aria_label:"Repeat",children:s.jsx(ge,{className:`${S?"stroke-green-400":"stroke-gray-400"}`,size:20}),onClick:()=>Y(e),className:"p-3 rounded-full bg-transparent hover:bg-[#777]"}),s.jsxs("div",{className:"flex items-center m-0 w-full space-x-3 max-w-[400px]",children:[s.jsx(me,{className:"stroke-green-400",size:35}),s.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:a.volumes[e]||.5,onChange:p=>_(p,e),className:"h-2 w-full rounded-lg cursor-pointer accent-green-500"}),s.jsxs("p",{className:"text-gray-400 text-sm text-right whitespace-nowrap",children:["File size: ",fe(y[t].fileSize)]})]})]}),s.jsx("audio",{inputMode:"text",ref:p=>w.current[e]=p,src:r.url,preload:"none"})]})},t)})}),s.jsx("div",{children:a.floatingPlayer&&s.jsx(je,{title:((A=y[a.playingIndex])==null?void 0:A.title)||"Track name",isPlaying:z,onPlay:()=>k(a.playingIndex),onPause:()=>k(a.playingIndex),onNext:$,onPrevious:X,onClosePlayer:()=>F(a.playingIndex),onVolumeChange:t=>_(t,a.playingIndex),currentVolume:a.volumes[a.playingIndex]||1})})]})};export{Le as default};

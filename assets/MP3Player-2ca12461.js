import{d as H,m as T,n as $,o as Q,p as Y,q as J,t as W,r as n,M as Z,U as ee,b as v,j as t,C as R,v as se,Q as te,w as ae,I as re,B as k,x as ne,y as le,z as oe,A as ce}from"./index-18ea2b47.js";function ie(r){const c=["Bytes","KB","MB","GB","TB"];if(r===0)return"0 Byte";const l=parseInt(Math.floor(Math.log(r)/Math.log(1024)),10);return`${(r/Math.pow(1024,l)).toFixed(2)} ${c[l]}`}async function ue(r,c){try{const l=H.currentUser;if(!l)throw new Error("User is not logged in.");const u=l.uid,o=T($,`users/${u}/mp3s`,r);await Q(o,c),console.log(`MP3 with ID ${r} updated successfully!`)}catch(l){console.error("Failed to update MP3:",l.message)}}const de=async(r,c,l,u,o,h,y)=>{try{const m=await fetch(r,{method:"GET",headers:{Range:`bytes=0-${o-1}`}});return m.status===206||m.status===200?(u.info("Link is fresh and valid"),!0):(u.info("Executing link refresh."),await me(u,c,l,h,y),!1)}catch(m){return console.error("Error checking the link:",m.message),u.error("Error checking the link."),null}},me=async(r,c,l,u,o)=>{const h=await Y(u,o);try{const m=await J({method:"get",url:"https://youtube-mp36.p.rapidapi.com/dl",headers:{"X-RapidAPI-Key":"bb6ca9e02bmsh37ace359628eb67p1cfcfcjsn8051f8356a0f","X-RapidAPI-Host":"youtube-mp36.p.rapidapi.com"},params:{id:c}}),{link:j}=m==null?void 0:m.data;if(!j){r.error("No download link provided. Please try again later.");return}const b=h.map(g=>g.youtubeID===c?{...g,url:j}:g),w=b.find(g=>g.youtubeID===c);if(w)return await ue(c,w),l(b),r.success("Link refreshed and replaced successfully!"),!0}catch(y){return r.error("Failed to refresh the link. Please try again."),console.error("Error refreshing the link:",y),!1}};async function pe(r,c,l,u){try{if(!r||!r.uid)throw new Error("User is not logged in.");const o=r.uid,h=T($,`users/${o}/mp3s`,c);return await W(h),l.success(u+" deleted succesfully!"),!0}catch(o){return console.error("Failed to delete MP3:",o==null?void 0:o.message),l.error("Failed to delete MP3:",o==null?void 0:o.message),!1}}const fe=()=>{const{mp3List:r,setMP3List:c,loading:l}=n.useContext(Z),{authUser:u,loadingUser:o}=n.useContext(ee),[h,y]=n.useState({}),[m,j]=n.useState(null),[b,w]=n.useState({volumes:{},progresses:{},tooltips:{}}),[g,z]=n.useState({}),[B,I]=n.useState(""),d=n.useRef([]),[p,N]=n.useState(null),P=n.useCallback(s=>{var a;const e=d.current[s];p!==null&&p!==s&&((a=d.current[p])==null||a.pause()),e!=null&&e.paused?(e==null||e.play(),N(s)):(e==null||e.pause(),N(null))},[p]),C=n.useCallback((s,e)=>{const a=d.current[e];if(a){const i=s.target.value/100*a.duration;a.currentTime=i,w(f=>({...f,progresses:{...f.progresses,[e]:s.target.value}}))}},[]),M=n.useCallback((s,e)=>{const a=s.target.value;w(i=>({...i,volumes:{...i.volumes,[e]:a}})),d.current[e].volume=a},[]),E=n.useCallback(s=>{const e=d.current[s];e&&w(a=>({...a,progresses:{...a.progresses,[s]:e.currentTime/e.duration*100}}))},[]);n.useEffect(()=>{r.forEach((s,e)=>{const a=d.current[e];if(a){const i=()=>E(e);return a.addEventListener("timeupdate",i),()=>a.removeEventListener("timeupdate",i)}})},[r,E]),n.useEffect(()=>{p!==null&&(async()=>{try{await d.current[p].play()}catch{v.error("Playback failed. Try refreshing the link.")}d.current.forEach((e,a)=>{e&&a!==p&&e.pause()})})()},[p]);const U=n.useCallback(s=>{const e=d.current[s];e&&isFinite(e.duration)&&z(a=>({...a,[s]:e.duration}))},[d.current]),L=n.useCallback(s=>{var f;const e=(f=r[s])==null?void 0:f.title,a=!h[s];y(x=>({...x,[s]:a}));const i=d.current[s];i&&(i.loop=a),v.dark(a?`Looping enabled for: ${e||"music"}`:`Looping disabled for: ${e||"music"}`)},[h,r]),A=n.useCallback(s=>{if(!isFinite(s))return"00:00";const e=Math.floor(s/60),a=Math.floor(s%60);return`${String(e).padStart(2,"0")}:${String(a).padStart(2,"0")}`},[]),S=async s=>{j(s.url);try{await de(s.url,s.youtubeID,c,v,s.fileSize,u,o)}catch(e){console.error("Error refreshing the link:",e)}finally{j(null)}},F=async s=>{u?(await pe(u,s.youtubeID,v,s.title),c(e=>e.filter(a=>a.youtubeID!==s.youtubeID))):v.error("You need to be logged in to delete this song.")},_=t.jsx("div",{className:"flex min-h-screen",children:t.jsx("section",{className:"flex-grow",children:t.jsx(R,{})})}),V=t.jsx("p",{className:"text-lg text-center text-gray-300 h-screen",children:"Convert any music to be able to listen to it here."}),G=({isPlaying:s,onClick:e})=>t.jsx(k,{aria_label:"Play&Pause",children:s?t.jsx(ne,{className:"stroke-green-400",size:20}):t.jsx(le,{className:"stroke-gray-400 ",size:20}),onClick:e,className:"p-2 rounded-full bg-transparent hover:bg-[#777]"}),K=({onRefresh:s,onDelete:e})=>t.jsxs("div",{className:"flex space-x-1 sm:space-x-4",children:[t.jsx(k,{aria_label:"Refresh item",children:"Refresh Link",onClick:s,className:"py-1 px-1 text-sm sm:py-2 sm:px-4 sm:text-base bg-[#555] text-[#4ecb52] hover:bg-[#777]"}),t.jsx(k,{aria_label:"Delete item",children:"Delete item",onClick:e,className:"py-1 px-1 text-sm sm:py-2 sm:px-4 sm:text-base bg-[#555] text-[#FF5252] hover:bg-[#777]"})]}),O=({progress:s,onChange:e})=>t.jsxs("div",{className:"relative w-full h-2 bg-gray-600 rounded-full max-w-[1000px]",children:[t.jsx("div",{className:"absolute top-0 left-0 h-full bg-green-500 rounded-full",style:{width:`${s}%`}}),t.jsx("input",{type:"range",min:"0",max:"100",className:"absolute top-0 left-0 w-full h-2 appearance-none cursor-pointer bg-transparent z-10",style:{opacity:0},value:s,onChange:e})]}),X=({isLooping:s,onLoopToggle:e,volume:a,onVolumeChange:i,fileSize:f})=>t.jsxs("div",{className:"flex items-center space-x-4 w-full",children:[t.jsx(k,{aria_label:"Repeat",children:t.jsx(oe,{className:s?"stroke-green-400":"stroke-gray-400",size:20}),onClick:e,className:"p-3 rounded-full bg-transparent hover:bg-[#777]"}),t.jsxs("div",{className:"flex items-center m-0 w-full space-x-3 max-w-[400px]",children:[t.jsx(ce,{className:"stroke-green-400",size:35}),t.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:a,onChange:i,className:"h-2 w-full rounded-lg cursor-pointer accent-green-500"}),t.jsxs("p",{className:"text-gray-400 text-sm text-right whitespace-nowrap",children:["File size: ",f]})]})]}),D=n.useCallback((s,e)=>{const a=e===p,i=m===s.url,f=A(g[e]||0);return t.jsx("li",{className:` ${i?"cursor-wait":"cursor-default"} p-3 sm:p-6 border rounded-lg ${a?"bg-[#494949] border-[#4ada31]":"bg-[#333] border-[#444]"} shadow-md transition-colors duration-300 max-w-full`,children:i?t.jsx(R,{}):t.jsxs("div",{className:"flex flex-col items-center space-y-2 sm:space-y-4 w-full max-w-[1000px] mx-auto",children:[t.jsxs("div",{className:"flex flex-col justify-start items-start text-start w-full space-y-3",children:[t.jsxs("div",{className:"flex items-center w-full",children:[t.jsx(G,{isPlaying:a,onClick:()=>P(e)}),t.jsx(se,{className:"text-sm sm:text-xl",target:"_blank",url:s.youtubeURL,href:s.url,title:s.title})]}),t.jsx("div",{className:"flex justify-between w-full space-x-4",children:t.jsx(K,{onRefresh:()=>S(s),onDelete:()=>F(s)})}),t.jsxs("p",{className:"text-sm text-gray-400 whitespace-nowrap",children:["Duration: ",f]})]}),t.jsx("audio",{ref:x=>d.current[e]=x,src:s.url,preload:"metadata",onLoadedMetadata:()=>U(e)}),t.jsx(O,{progress:b.progresses[e]||0,onChange:x=>C(x,e)}),t.jsx(X,{isLooping:h[e]||!1,onLoopToggle:()=>L(e),volume:b.volumes[e]||.5,onVolumeChange:x=>M(x,e),fileSize:ie(s.fileSize)})]})},e)},[p,b,P,S,F,L,M,C]),q=n.useMemo(()=>t.jsx("ul",{className:"space-y-4 sm:space-y-6 text-ssm max-w-[1000px] w-full min-h-screen mx-auto",children:r.map((s,e)=>D(s,e))}),[r,D]);return t.jsxs("div",{className:"bg-[#1E1E1E] pt-20 px-2 sm:px-6 py-14 sm:py-8",children:[t.jsx(te,{stacked:!0,position:"bottom-right",transition:ae,limit:8}),t.jsxs("div",{className:"bg-[#1E1E1E] p-4 flex justify-center items-center space-x-8",children:[t.jsxs("h1",{className:"text-2xl font-bold text-white ",children:[t.jsx("span",{children:r.length})," Songs"]}),t.jsx(re,{type:"search",placeholder:"Search for a song",value:B,onChange:s=>I(s.target.value),className:"my-4 text-white bg-[#333] border-[#444] rounded w-full max-w-[600px] p-2"})]}),l&&_,r.length===0&&V,q]})};export{fe as default};
